# Coretet Development Context - January 30, 2025

## Project Overview
Coretet is a music library management application built with React, TypeScript, Tailwind CSS, and Supabase. It features track management, playlists, collaborative features, and a custom audio player with waveform visualization.

## Recent Session Summary (January 30, 2025)

### Major Accomplishments
1. **Fixed Critical Audio Playback Issue**
   - Resolved 400 Bad Request errors that started at 9:28 PM
   - Restored secure URL fetching in AudioContext.tsx with fallback mechanism
   - Tracks now play correctly with proper error handling

2. **UI/UX Improvements**
   - Moved search bar from middle column to left sidebar
   - Removed "Library" title from middle column header
   - Consolidated header controls to single line
   - Changed "Category" to "Type" throughout UI
   - Fixed duplicate Edit/Clear/Delete buttons
   - Added proper padding to prevent controls touching edges

3. **Manual Order Mode for Playlists**
   - Fixed issue where playlists auto-enabled manual ordering
   - Added explicit Manual Order option in sort dropdown
   - Implemented Save Order button with pending changes tracking
   - Added visual feedback (animate-pulse) for unsaved changes
   - Manual order now only activates when explicitly selected

4. **Dropdown Positioning Fixes**
   - Fixed z-index conflicts causing dropdowns to hide behind sidebar
   - Changed dropdown alignment from center to left
   - Maintained proper scrolling after z-index adjustments

5. **Toast Notification System**
   - Created Toast component and ToastContext
   - Replaced all alert() calls with elegant toast notifications
   - Added slide-in animation from bottom-right
   - Success, error, and info toast types

6. **New Detailed Waveform**
   - Replaced blocky waveform with DAW-style detailed visualization
   - Shows actual audio waveform shape (min/max per pixel)
   - Interactive: click to seek, hover for time tooltip
   - Coral playhead line for visibility
   - Yellow played portion, silver unplayed portion
   - Integrated with secure URL fetching

### Current State
- All changes committed and pushed to main branch
- Manual order mode working correctly (not auto-enabled)
- Toast notifications replacing alerts
- New detailed waveform in Track Details panel
- All audio playback issues resolved

## Key Files Modified
- `/src/contexts/AudioContext.tsx` - Fixed secure URL fetching
- `/src/components/Library/TrackList.tsx` - Major refactor for manual ordering
- `/src/components/Library/TrackListView.tsx` - Added play button, fixed drag handles
- `/src/components/Layout/Sidebar.tsx` - Added search functionality
- `/src/components/TrackDetails/TrackDetailsPanel.tsx` - New waveform integration
- `/src/components/Audio/DetailedWaveform.tsx` - New DAW-style waveform component
- `/src/components/common/Toast.tsx` - Toast notification component
- `/src/contexts/ToastContext.tsx` - Toast notification context
- `/src/components/MainApp.tsx` - Added ToastProvider, z-index fixes

## Design System
- **Colors**: 
  - Forest theme: dark (#0a1612), main (#1a2e26), light (#243830)
  - Accents: yellow (#e4da38), coral (#d27556)
  - Text: silver (#ebeae8)
- **Fonts**: Anton (headers), Quicksand (body)
- **Spacing**: Consistent padding/margins, proper header heights

## Pending To-Do Items

### High Priority
1. **Arrangements Feature** - Ability to mark and save sections within tracks
   - Use the new detailed waveform for precise selection
   - Create UI for marking verses, choruses, bridges, etc.
   - Save arrangement data to database
   - Allow multiple arrangements per track

2. **Performance Optimization**
   - Implement virtual scrolling for large track lists
   - Optimize waveform rendering for long tracks
   - Add caching for waveform data

3. **Mobile Responsiveness**
   - Test and fix layout on mobile devices
   - Ensure touch interactions work properly
   - Optimize waveform for mobile screens

### Medium Priority
1. **Search Improvements**
   - Add advanced search filters
   - Implement fuzzy search
   - Add search history

2. **Playlist Enhancements**
   - Add playlist cover images
   - Implement smart playlists
   - Add playlist folders/organization

3. **Track Details Enhancements**
   - Add BPM detection
   - Implement key detection
   - Add more metadata fields

### Low Priority
1. **UI Polish**
   - Add more animations/transitions
   - Implement dark/light theme toggle
   - Add keyboard shortcuts overlay

2. **Export Features**
   - Export playlists to various formats
   - Backup/restore functionality
   - Integration with other music services

## Known Issues
1. Waveform may take time to load for large files
2. Some dropdowns may still have positioning issues in edge cases
3. Manual order state doesn't persist across page refreshes (uses view preferences)

## Testing Checklist
- [ ] Audio playback works for all file types
- [ ] Manual order mode only activates when selected
- [ ] Save Order button appears/works correctly
- [ ] Toast notifications appear properly
- [ ] Waveform displays and interacts correctly
- [ ] Search in sidebar works
- [ ] Dropdowns don't get cut off
- [ ] All CRUD operations work

## Development Setup
```bash
# Install dependencies
npm install

# Run development server
npm run dev

# Build for production
npm run build
```

## Environment Requirements
- Node.js 18+
- npm or yarn
- Supabase project with proper schema
- Environment variables configured

## Next Session Starting Points
1. Begin implementing the Arrangements feature using the new detailed waveform
2. Add unit tests for the new components (Toast, DetailedWaveform)
3. Optimize performance for large music libraries
4. Implement keyboard shortcuts for power users
5. Add batch operations for track management

## Important Context for AI Assistant
- The app uses Supabase for backend with RLS policies
- Audio files are stored in Supabase Storage
- Secure URLs are fetched via Edge Function with fallback to public URLs
- View preferences are stored per user/context in database
- Manual ordering uses track positions stored in playlists/collections
- The app supports collaborative playlists with shared ratings
- Soft delete is implemented with 30-day recovery period

## Recent Bug Fixes to Remember
1. Audio 400 errors - Always use secure URL fetching with fallback
2. Manual order auto-enabling - Check isManualOrderMode state, not just sortBy
3. Dropdown positioning - Use left alignment to avoid sidebar conflicts
4. Z-index stacking - Middle column needs relative z-30 for dropdowns

This context should help you quickly get back up to speed with the current state of the Coretet project and continue development seamlessly.