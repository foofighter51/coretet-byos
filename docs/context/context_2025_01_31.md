# Coretet Development Context - January 31, 2025

## Project Overview
Coretet is a music library management application built with React, TypeScript, Tailwind CSS, and Supabase. It features track management, playlists, collaborative features, and a custom audio player with waveform visualization.

## Recent Session Summary (January 31, 2025)

### Major Accomplishments Since January 30

1. **Interactive Tutorial System Enhancement**
   - Changed overlay from dark (80% black) to light (40% gray) for better visibility
   - Fixed tooltip positioning to stay within viewport bounds
   - Added intelligent positioning that flips tooltips when near edges
   - Added Track Variations section explaining the VAR feature
   - Expanded playlist sharing section with detailed collaboration info
   - Added Coming Soon section highlighting upcoming features
   - Improved content formatting with better spacing and icons
   - Synced both tutorial modals with consistent content

2. **Waveform Compression Bug Fix**
   - Fixed bug where waveform appeared compressed on first track after login
   - Used container width instead of canvas width for waveform generation
   - Added proper scaling when drawing waveform to handle size mismatches
   - Ensured canvas is properly sized before generating waveform data
   - Added delay to handle initial sizing after login
   - Only resize canvas when dimensions actually change

3. **Feedback System Implementation**
   - Created Edge Function (send-feedback) for handling user feedback
   - Integrated with Resend API for email notifications
   - Added file attachment support for feedback
   - Stores feedback in database with fallback if email fails
   - Sends formatted emails to coretetapp@gmail.com

4. **Arrangements Feature - Database Ready**
   - Created complete database schema for arrangements feature
   - Added tables: audio_sections, arrangements, arrangement_sections
   - Implemented comprehensive RLS policies for security
   - Created TypeScript interfaces for type safety
   - Ready for UI implementation

### Current State
- All changes committed and pushed to main branch
- Interactive tutorial working with improved UI/UX
- Waveform rendering reliably without compression issues
- Feedback system operational with email notifications
- Arrangements database schema ready for implementation

## Key Files Modified/Added Since January 30
- `/src/components/Tutorial/InteractiveTutorial.tsx` - Enhanced tutorial UI
- `/src/components/Tutorial/TutorialModal.tsx` - Updated tutorial content
- `/src/components/Audio/DetailedWaveform.tsx` - Fixed waveform compression
- `/supabase/functions/send-feedback/index.ts` - New feedback edge function
- `/arrangements/arrangement.sql` - Database schema for arrangements
- `/arrangements/audio.ts` - TypeScript types for arrangements
- `/feedback/personas/` - New folder with UI mockups/screenshots

## Design System
- **Colors**: 
  - Forest theme: dark (#0a1612), main (#1a2e26), light (#243830)
  - Accents: yellow (#e4da38), coral (#d27556)
  - Text: silver (#ebeae8)
- **Fonts**: Anton (headers), Quicksand (body)
- **Spacing**: Consistent padding/margins, proper header heights

## Pending To-Do Items

### High Priority
1. **Arrangements Feature UI Implementation** 
   - Build UI components for marking sections on the detailed waveform
   - Create section management interface (add, edit, delete sections)
   - Implement arrangement builder (drag & drop sections)
   - Add playback controls for arrangements
   - Create arrangement templates (verse/chorus/bridge)
   - Database schema is ready, just needs UI

2. **Performance Optimization**
   - Implement virtual scrolling for large track lists
   - Optimize waveform rendering for long tracks
   - Add caching for waveform data

3. **Mobile Responsiveness**
   - Test and fix layout on mobile devices
   - Ensure touch interactions work properly
   - Optimize waveform for mobile screens

### Medium Priority
1. **Search Improvements**
   - Add advanced search filters
   - Implement fuzzy search
   - Add search history

2. **Playlist Enhancements**
   - Add playlist cover images
   - Implement smart playlists
   - Add playlist folders/organization

3. **Track Details Enhancements**
   - Add BPM detection
   - Implement key detection
   - Add more metadata fields

### Low Priority
1. **UI Polish**
   - Add more animations/transitions
   - Implement dark/light theme toggle
   - Add keyboard shortcuts overlay

2. **Export Features**
   - Export playlists to various formats
   - Backup/restore functionality
   - Integration with other music services

## Known Issues
1. Waveform may take time to load for large files
2. Some dropdowns may still have positioning issues in edge cases
3. Manual order state doesn't persist across page refreshes (uses view preferences)

## Testing Checklist
- [x] Audio playback works for all file types
- [x] Manual order mode only activates when selected
- [x] Save Order button appears/works correctly
- [x] Toast notifications appear properly
- [x] Waveform displays and interacts correctly
- [x] Search in sidebar works
- [x] Dropdowns don't get cut off
- [x] All CRUD operations work
- [x] Tutorial system works with proper positioning
- [x] Feedback system sends emails correctly

## Development Setup
```bash
# Install dependencies
npm install

# Run development server
npm run dev

# Build for production
npm run build

# Deploy Edge Functions
supabase functions deploy send-feedback
```

## Environment Requirements
- Node.js 18+
- npm or yarn
- Supabase project with proper schema
- Environment variables configured
- Resend API key for feedback emails

## Next Session Starting Points
1. **Implement Arrangements UI** - Priority #1
   - Create ArrangementEditor component
   - Add section marking tools to DetailedWaveform
   - Build arrangement playback controls
   - Implement section management UI
   
2. Add unit tests for new components (Toast, DetailedWaveform, Tutorial)
3. Optimize performance for large music libraries
4. Implement keyboard shortcuts for power users
5. Add batch operations for track management

## Important Context for AI Assistant
- The app uses Supabase for backend with RLS policies
- Audio files are stored in Supabase Storage
- Secure URLs are fetched via Edge Function with fallback to public URLs
- View preferences are stored per user/context in database
- Manual ordering uses track positions stored in playlists/collections
- The app supports collaborative playlists with shared ratings
- Soft delete is implemented with 30-day recovery period
- Feedback system uses Resend API for email notifications
- Tutorial system uses React Portal for overlay and highlighting

## Recent Bug Fixes to Remember
1. Audio 400 errors - Always use secure URL fetching with fallback
2. Manual order auto-enabling - Check isManualOrderMode state, not just sortBy
3. Dropdown positioning - Use left alignment to avoid sidebar conflicts
4. Z-index stacking - Middle column needs relative z-30 for dropdowns
5. Waveform compression - Use container width, not canvas width for sizing
6. Tutorial tooltips - Implement viewport boundary detection for positioning

## Database Schema Updates
- Added arrangements feature tables (audio_sections, arrangements, arrangement_sections)
- Comprehensive RLS policies for collaborative editing
- Indexes added for performance optimization

## Edge Functions
- `send-feedback` - Handles user feedback with email notifications via Resend

This context should help you quickly get back up to speed with the current state of the Coretet project and continue development seamlessly.